
version: '3.8'

services:
  redis:
    image: redis:alpine
    container_name: tender_redis
    ports:
      - "6379:6379"
    restart: always

  worker:
    build: .
    container_name: tender_worker
    # Scale this by running: docker-compose up --scale worker=5
    restart: always
    environment:
      - CELERY_HOST=redis
      - REDIS_URL=redis://redis:6379/0
      - DB_HOST=host.docker.internal
      - DB_USER=root
      - DB_PASSWORD=
      - DB_NAME=tender_automation_with_ai
    volumes:
      # Map current directory to /app so we can see OUTPUT/ logs etc
      - .:/app
    depends_on:
      - redis
    # Special network setting to allow container to access host localhost
    extra_hosts:
      - "host.docker.internal:host-gateway"

  # Optional: Dashboard for monitoring (Flower)
  dashboard:
    image: mher/flower
    container_name: tender_dashboard
    environment:
      - CELERY_BROKER_URL=redis://redis:6379/0
      - FLOWER_PORT=5555
    ports:
      - "5555:5555"
    depends_on:
      - redis
